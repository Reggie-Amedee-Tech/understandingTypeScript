(()=>{"use strict";class e{constructor(e,t,n,r){this.templateElement=document.getElementById(e),this.hostElement=document.getElementById(t);const s=document.importNode(this.templateElement.content,!0);this.element=s.firstElementChild,r&&(this.element.id=r),this.attach(n)}attach(e){this.hostElement.insertAdjacentElement(e?"afterbegin":"beforeend",this.element)}}function t(e){let t=!0;return e.required&&(t=t&&0!==e.value.toString().trim().length),null!=e.minLength&&"string"==typeof e.value&&(t=t&&e.value.length>=e.minLength),null!=e.maxLength&&"string"==typeof e.value&&(t=t&&e.value.length<=e.maxLength),null!=e.min&&"number"==typeof e.value&&(t=t&&e.value>=e.min),null!=e.max&&"number"==typeof e.value&&(t=t&&e.value<=e.max),t}function n(e,t,n){const r=n.value;return{configurable:!0,get(){return r.bind(this)}}}var r;!function(e){e[e.Active=0]="Active",e[e.Finished=1]="Finished"}(r||(r={}));class s{constructor(e,t,n,r,s){this.id=e,this.title=t,this.description=n,this.people=r,this.status=s}}class i{constructor(){this.listeners=[]}addListener(e){this.listeners.push(e)}}class o extends i{constructor(){super(),this.projects=[]}static getInstance(){return this.instance||(this.instance=new o),this.instance}addProject(e,t,n){const i=new s(Math.random().toString(),e,t,n,r.Active);this.projects.push(i),this.updateListeners()}moveProject(e,t){const n=this.projects.find((t=>t.id===e));n&&n.status!==t&&(n.status=t,this.updateListeners())}updateListeners(){for(const e of this.listeners)e(this.projects.slice())}}const l=o.getInstance();class a extends e{constructor(){super("project-input","app",!0,"user-input"),this.titleInputElement=this.element.querySelector("#title"),this.descriptionInputElement=this.element.querySelector("#description"),this.peopleElement=this.element.querySelector("#people"),this.configure()}configure(){this.element.addEventListener("submit",this.submitHandler)}gatherUserInput(){const e=this.titleInputElement.value,n=this.descriptionInputElement.value,r=this.peopleElement.value,s={value:e,required:!0},i={value:n,required:!0,minLength:5},o={value:+r,required:!0,min:1,max:5};return t(s)&&t(i)&&t(o)?[e,n,+r]:(console.log(s,o,i),void alert("Invalid Input, please try again!"))}clearInputs(){this.titleInputElement.value="",this.descriptionInputElement.value="",this.peopleElement.value=""}submitHandler(e){e.preventDefault();const t=this.gatherUserInput();if(console.log(t),Array.isArray(t)){const[e,n,r]=t;l.addProject(e,n,r),console.log(e,n,r)}console.log(t,"YO"),this.clearInputs()}renderContent(){}}!function(e,t,n,r){var s,i=arguments.length,o=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var l=e.length-1;l>=0;l--)(s=e[l])&&(o=(i<3?s(o):i>3?s(t,n,o):s(t,n))||o);i>3&&o&&Object.defineProperty(t,n,o)}([n],a.prototype,"submitHandler",null);class c extends e{get persons(){return 1===this.project.people?"1 Person":`${this.project.people} persons`}constructor(e,t){super("single-project",e,!1,t.id),this.project=t,this.configure(),this.renderContent()}dragStartHandler(e){e.dataTransfer.setData("text/plain",this.project.id),e.dataTransfer.effectAllowed="move"}dragEndHandler(e){console.log("DragEnd")}configure(){this.element.addEventListener("dragstart",this.dragStartHandler)}renderContent(){this.element.querySelector("h2").textContent=this.project.title,this.element.querySelector("h3").textContent=this.persons+" assigned!",this.element.querySelector("p").textContent=this.project.description}}!function(e,t,n,r){var s,i=arguments.length,o=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var l=e.length-1;l>=0;l--)(s=e[l])&&(o=(i<3?s(o):i>3?s(t,n,o):s(t,n))||o);i>3&&o&&Object.defineProperty(t,n,o)}([n],c.prototype,"dragStartHandler",null);var d=function(e,t,n,r){var s,i=arguments.length,o=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var l=e.length-1;l>=0;l--)(s=e[l])&&(o=(i<3?s(o):i>3?s(t,n,o):s(t,n))||o);return i>3&&o&&Object.defineProperty(t,n,o),o};class u extends e{constructor(e){super("project-list","app",!1,`${e}-projects`),this.type=e,this.assignedProjects=[],this.configure(),this.renderContent()}dropHandler(e){const t=e.dataTransfer.getData("text/plain");l.moveProject(t,"active"===this.type?r.Active:r.Finished)}dragOverHandler(e){e.dataTransfer&&"text/plain"===e.dataTransfer.types[0]&&(e.preventDefault(),this.element.querySelector("ul").classList.add("droppable"))}dragLeaveHandler(e){document.querySelector("ul").classList.remove("droppable")}renderProjects(){document.getElementById(`${this.type}-projects-list`).innerHTML="";for(const e of this.assignedProjects)new c(this.element.querySelector("ul").id,e)}configure(){this.element.addEventListener("dragover",this.dragOverHandler),this.element.addEventListener("dragleave",this.dragLeaveHandler),this.element.addEventListener("drop",this.dropHandler),l.addListener((e=>{const t=e.filter((e=>"active"===this.type?e.status===r.Active:e.status===r.Finished));this.assignedProjects=t,this.renderProjects()}))}renderContent(){const e=`${this.type}-projects-list`;this.element.querySelector("ul").id=e,this.element.querySelector("h2").textContent=this.type.toUpperCase()+" PROJECTS"}}d([n],u.prototype,"dropHandler",null),d([n],u.prototype,"dragOverHandler",null),d([n],u.prototype,"dragLeaveHandler",null),new a,new u("active"),new u("finished")})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QixXQUM5RSxFQW5EQSxHQURDNUYsRyxnQ0FPRCxHQURDQSxHLG9DQVdELEdBRENBLEcscUNDL0JULElBQUl1QyxFQUNKLElBQUlrQyxFQUFZLFVBQ2hCLElBQUlBLEVBQVksVyIsInNvdXJjZXMiOlsid2VicGFjazovL3VuZGVyc3RhbmRpbmctdHMtcHJvamVjdC8uL3NyYy9jb21wb25lbnRzL2Jhc2UtY29tcG9uZW50LnRzIiwid2VicGFjazovL3VuZGVyc3RhbmRpbmctdHMtcHJvamVjdC8uL3NyYy91dGlscy92YWxpZGF0b3IudHMiLCJ3ZWJwYWNrOi8vdW5kZXJzdGFuZGluZy10cy1wcm9qZWN0Ly4vc3JjL2RlY29yYXRvcnMvYXV0b2JpbmQudHMiLCJ3ZWJwYWNrOi8vdW5kZXJzdGFuZGluZy10cy1wcm9qZWN0Ly4vc3JjL21vZGVscy9wcm9qZWN0LnRzIiwid2VicGFjazovL3VuZGVyc3RhbmRpbmctdHMtcHJvamVjdC8uL3NyYy9zdGF0ZS9wcm9qZWN0LXN0YXRlLnRzIiwid2VicGFjazovL3VuZGVyc3RhbmRpbmctdHMtcHJvamVjdC8uL3NyYy9jb21wb25lbnRzL3Byb2plY3QtaW5wdXQudHMiLCJ3ZWJwYWNrOi8vdW5kZXJzdGFuZGluZy10cy1wcm9qZWN0Ly4vc3JjL2NvbXBvbmVudHMvcHJvamVjdC1pdGVtLnRzIiwid2VicGFjazovL3VuZGVyc3RhbmRpbmctdHMtcHJvamVjdC8uL3NyYy9jb21wb25lbnRzL3Byb2plY3QtbGlzdC50cyIsIndlYnBhY2s6Ly91bmRlcnN0YW5kaW5nLXRzLXByb2plY3QvLi9zcmMvYXBwLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENvbXBvbmVudCBCYXNlIENsYXNzXG5cbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBDb21wb25lbnQ8VCBleHRlbmRzIEhUTUxFbGVtZW50LCBVIGV4dGVuZHMgSFRNTEVsZW1lbnQ+IHtcbiAgICB0ZW1wbGF0ZUVsZW1lbnQ6IEhUTUxUZW1wbGF0ZUVsZW1lbnQ7XG4gICAgaG9zdEVsZW1lbnQ6IFQ7XG4gICAgZWxlbWVudDogVTtcblxuICAgIGNvbnN0cnVjdG9yKHRlbXBsYXRlSWQ6IHN0cmluZywgaG9zdEVsZW1lbnRzOiBzdHJpbmcsIGluc2VydEF0U3RhcnQ6IGJvb2xlYW4sIG5ld0VsZW1lbnRJZD86IHN0cmluZykge1xuICAgICAgICB0aGlzLnRlbXBsYXRlRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRlbXBsYXRlSWQpISBhcyBIVE1MVGVtcGxhdGVFbGVtZW50O1xuICAgICAgICB0aGlzLmhvc3RFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaG9zdEVsZW1lbnRzKSEgYXMgVDtcblxuICAgICAgICBjb25zdCBpbXBvcnRlZE5vZGUgPSBkb2N1bWVudC5pbXBvcnROb2RlKHRoaXMudGVtcGxhdGVFbGVtZW50LmNvbnRlbnQsIHRydWUpO1xuICAgICAgICB0aGlzLmVsZW1lbnQgPSBpbXBvcnRlZE5vZGUuZmlyc3RFbGVtZW50Q2hpbGQgYXMgVTtcbiAgICAgICAgaWYgKG5ld0VsZW1lbnRJZCkge1xuICAgICAgICAgICAgdGhpcy5lbGVtZW50LmlkID0gbmV3RWxlbWVudElkXG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5hdHRhY2goaW5zZXJ0QXRTdGFydCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBhdHRhY2goaW5zZXJ0QXRCZWdpbm5pbmc6IEJvb2xlYW4pIHtcbiAgICAgICAgdGhpcy5ob3N0RWxlbWVudC5pbnNlcnRBZGphY2VudEVsZW1lbnQoaW5zZXJ0QXRCZWdpbm5pbmcgPyAnYWZ0ZXJiZWdpbicgOiAnYmVmb3JlZW5kJywgdGhpcy5lbGVtZW50KTtcbiAgICB9XG5cbiAgICBhYnN0cmFjdCBjb25maWd1cmU/KCk6IHZvaWQ7XG5cbiAgICBhYnN0cmFjdCByZW5kZXJDb250ZW50KCk6IHZvaWQ7XG5cbn1cbiIsIlxuICAgIC8vIFZhbGlkYXRpb25cbmV4cG9ydCBpbnRlcmZhY2UgVmFsaWRhdGFibGUge1xuICAgIHZhbHVlOiBzdHJpbmcgfCBudW1iZXI7XG4gICAgcmVxdWlyZWQ/OiBib29sZWFuO1xuICAgIG1pbkxlbmd0aD86IG51bWJlcjtcbiAgICBtYXhMZW5ndGg/OiBudW1iZXI7XG4gICAgbWluPzogbnVtYmVyO1xuICAgIG1heD86IG51bWJlcjtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHZhbGlkYXRlKHZhbGlkYXRhYmxlSW5wdXQ6IFZhbGlkYXRhYmxlKSB7XG4gICAgbGV0IGlzVmFsaWQgPSB0cnVlO1xuICAgIGlmICh2YWxpZGF0YWJsZUlucHV0LnJlcXVpcmVkKSB7XG4gICAgICAgIGlzVmFsaWQgPSBpc1ZhbGlkICYmIHZhbGlkYXRhYmxlSW5wdXQudmFsdWUudG9TdHJpbmcoKS50cmltKCkubGVuZ3RoICE9PSAwO1xuICAgIH1cbiAgICBpZiAoXG4gICAgICAgIHZhbGlkYXRhYmxlSW5wdXQubWluTGVuZ3RoICE9IG51bGwgJiZcbiAgICAgICAgdHlwZW9mIHZhbGlkYXRhYmxlSW5wdXQudmFsdWUgPT09ICdzdHJpbmcnXG4gICAgKSB7XG4gICAgICAgIGlzVmFsaWQgPVxuICAgICAgICAgICAgaXNWYWxpZCAmJiB2YWxpZGF0YWJsZUlucHV0LnZhbHVlLmxlbmd0aCA+PSB2YWxpZGF0YWJsZUlucHV0Lm1pbkxlbmd0aDtcbiAgICB9XG4gICAgaWYgKFxuICAgICAgICB2YWxpZGF0YWJsZUlucHV0Lm1heExlbmd0aCAhPSBudWxsICYmXG4gICAgICAgIHR5cGVvZiB2YWxpZGF0YWJsZUlucHV0LnZhbHVlID09PSAnc3RyaW5nJ1xuICAgICkge1xuICAgICAgICBpc1ZhbGlkID1cbiAgICAgICAgICAgIGlzVmFsaWQgJiYgdmFsaWRhdGFibGVJbnB1dC52YWx1ZS5sZW5ndGggPD0gdmFsaWRhdGFibGVJbnB1dC5tYXhMZW5ndGg7XG4gICAgfVxuICAgIGlmIChcbiAgICAgICAgdmFsaWRhdGFibGVJbnB1dC5taW4gIT0gbnVsbCAmJlxuICAgICAgICB0eXBlb2YgdmFsaWRhdGFibGVJbnB1dC52YWx1ZSA9PT0gJ251bWJlcidcbiAgICApIHtcbiAgICAgICAgaXNWYWxpZCA9IGlzVmFsaWQgJiYgdmFsaWRhdGFibGVJbnB1dC52YWx1ZSA+PSB2YWxpZGF0YWJsZUlucHV0Lm1pbjtcbiAgICB9XG4gICAgaWYgKFxuICAgICAgICB2YWxpZGF0YWJsZUlucHV0Lm1heCAhPSBudWxsICYmXG4gICAgICAgIHR5cGVvZiB2YWxpZGF0YWJsZUlucHV0LnZhbHVlID09PSAnbnVtYmVyJ1xuICAgICkge1xuICAgICAgICBpc1ZhbGlkID0gaXNWYWxpZCAmJiB2YWxpZGF0YWJsZUlucHV0LnZhbHVlIDw9IHZhbGlkYXRhYmxlSW5wdXQubWF4O1xuICAgIH1cbiAgICByZXR1cm4gaXNWYWxpZDtcbn1cbiIsIi8vIGF1dG9iaW5kIGRlY29yYXRvclxuXG5leHBvcnQgZnVuY3Rpb24gYXV0b2JpbmQoXzogYW55LCBfMjogc3RyaW5nLCBkZXNjcmlwdG9yOiBQcm9wZXJ0eURlc2NyaXB0b3IpIHtcbiAgICBjb25zdCBvcmlnaW5hbE1ldGhvZCA9IGRlc2NyaXB0b3IudmFsdWU7XG4gICAgY29uc3QgYWRqRGVzY3JpcHRvcjogUHJvcGVydHlEZXNjcmlwdG9yID0ge1xuICAgICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICAgIGdldCgpIHtcbiAgICAgICAgICAgIGNvbnN0IGJvdW5kRm4gPSBvcmlnaW5hbE1ldGhvZC5iaW5kKHRoaXMpO1xuICAgICAgICAgICAgcmV0dXJuIGJvdW5kRm47XG4gICAgICAgIH1cbiAgICB9O1xuICAgIHJldHVybiBhZGpEZXNjcmlwdG9yO1xufVxuIiwiLy8gUHJvamVjdCBUeXBlXG5cbmV4cG9ydCBlbnVtIFByb2plY3RTdGF0dXMgeyBcbiAgICBBY3RpdmUsIFxuICAgIEZpbmlzaGVkIH1cblxuZXhwb3J0IGNsYXNzIFByb2plY3Qge1xuICAgIGNvbnN0cnVjdG9yKFxuICAgICAgICBwdWJsaWMgaWQ6IHN0cmluZywgXG4gICAgICAgIHB1YmxpYyB0aXRsZTogc3RyaW5nLCBcbiAgICAgICAgcHVibGljIGRlc2NyaXB0aW9uOiBzdHJpbmcsIFxuICAgICAgICBwdWJsaWMgcGVvcGxlOiBudW1iZXIsIFxuICAgICAgICBwdWJsaWMgc3RhdHVzOiBQcm9qZWN0U3RhdHVzKSB7XG4gICAgfVxufVxuIiwiaW1wb3J0IHsgUHJvamVjdCwgUHJvamVjdFN0YXR1cyB9IGZyb20gJy4uL21vZGVscy9wcm9qZWN0JztcblxuLy8gTGlzdGVuZXJcbnR5cGUgTGlzdGVuZXI8VD4gPSAoaXRlbXM6IFRbXSkgPT4gdm9pZDtcblxuLy8gUHJvamVjdCBzdGF0ZSBtYW5hZ2VtZW50IGNsYXNzXG5jbGFzcyBTdGF0ZTxUPiB7XG4gICAgcHJvdGVjdGVkIGxpc3RlbmVyczogTGlzdGVuZXI8VD5bXSA9IFtdO1xuXG4gICAgYWRkTGlzdGVuZXIobGlzdGVuZXJGbjogTGlzdGVuZXI8VD4pIHtcbiAgICAgICAgdGhpcy5saXN0ZW5lcnMucHVzaChsaXN0ZW5lckZuKVxuICAgIH1cbn1cblxuZXhwb3J0IGNsYXNzIFByb2plY3RTdGF0ZSBleHRlbmRzIFN0YXRlPFByb2plY3Q+IHtcbiAgICBwcml2YXRlIHByb2plY3RzOiBQcm9qZWN0W10gPSBbXTtcbiAgICBwcml2YXRlIHN0YXRpYyBpbnN0YW5jZTogUHJvamVjdFN0YXRlO1xuXG4gICAgcHJpdmF0ZSBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgc3VwZXIoKVxuICAgIH1cblxuICAgIHN0YXRpYyBnZXRJbnN0YW5jZSgpIHtcbiAgICAgICAgaWYgKHRoaXMuaW5zdGFuY2UpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmluc3RhbmNlXG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmluc3RhbmNlID0gbmV3IFByb2plY3RTdGF0ZSgpO1xuICAgICAgICByZXR1cm4gdGhpcy5pbnN0YW5jZTtcbiAgICB9XG5cbiAgICBhZGRQcm9qZWN0KHRpdGxlOiBzdHJpbmcsIGRlc2NyaXB0aW9uOiBzdHJpbmcsIG51bU9mUGVvcGxlOiBudW1iZXIpIHtcblxuICAgICAgICBjb25zdCBuZXdQcm9qZWN0ID0gbmV3IFByb2plY3QoXG4gICAgICAgICAgICBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKCksXG4gICAgICAgICAgICB0aXRsZSxcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgbnVtT2ZQZW9wbGUsXG4gICAgICAgICAgICBQcm9qZWN0U3RhdHVzLkFjdGl2ZVxuICAgICAgICApXG4gICAgICAgIHRoaXMucHJvamVjdHMucHVzaChuZXdQcm9qZWN0KTtcbiAgICAgICAgdGhpcy51cGRhdGVMaXN0ZW5lcnMoKVxuICAgIH1cblxuICAgIG1vdmVQcm9qZWN0KHByb2plY3RJZDogc3RyaW5nLCBuZXdTdGF0dXM6IFByb2plY3RTdGF0dXMpIHtcbiAgICAgICAgY29uc3QgcHJvamVjdCA9IHRoaXMucHJvamVjdHMuZmluZChwcmogPT4gcHJqLmlkID09PSBwcm9qZWN0SWQpO1xuICAgICAgICBpZihwcm9qZWN0ICYmIHByb2plY3Quc3RhdHVzICE9PSBuZXdTdGF0dXMpIHtcbiAgICAgICAgICAgIHByb2plY3Quc3RhdHVzID0gbmV3U3RhdHVzO1xuICAgICAgICAgICAgdGhpcy51cGRhdGVMaXN0ZW5lcnMoKVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSB1cGRhdGVMaXN0ZW5lcnMoKSB7XG4gICAgICAgIGZvciAoY29uc3QgbGlzdGVuZXJGbiBvZiB0aGlzLmxpc3RlbmVycykge1xuICAgICAgICAgICAgbGlzdGVuZXJGbih0aGlzLnByb2plY3RzLnNsaWNlKCkpXG4gICAgICAgIH1cbiAgICB9XG59XG5cbmV4cG9ydCBjb25zdCBwcm9qZWN0U3RhdGUgPSBQcm9qZWN0U3RhdGUuZ2V0SW5zdGFuY2UoKTtcblxuIiwiaW1wb3J0IHsgQ29tcG9uZW50IH0gZnJvbSBcIi4vYmFzZS1jb21wb25lbnRcIjtcbmltcG9ydCB7IFZhbGlkYXRhYmxlLCB2YWxpZGF0ZSB9IGZyb20gJy4uL3V0aWxzL3ZhbGlkYXRvcic7XG5pbXBvcnQgeyBhdXRvYmluZCB9IGZyb20gJy4uL2RlY29yYXRvcnMvYXV0b2JpbmQnO1xuaW1wb3J0IHsgcHJvamVjdFN0YXRlIH0gZnJvbSAnLi4vc3RhdGUvcHJvamVjdC1zdGF0ZSc7XG5cblxuZXhwb3J0IGNsYXNzIFByb2plY3RJbnB1dCBleHRlbmRzIENvbXBvbmVudDxIVE1MRGl2RWxlbWVudCwgSFRNTEZvcm1FbGVtZW50PiB7XG4gICAgICAgIHRpdGxlSW5wdXRFbGVtZW50OiBIVE1MSW5wdXRFbGVtZW50O1xuICAgICAgICBkZXNjcmlwdGlvbklucHV0RWxlbWVudDogSFRNTElucHV0RWxlbWVudDtcbiAgICAgICAgcGVvcGxlRWxlbWVudDogSFRNTElucHV0RWxlbWVudDtcbiAgICBcbiAgICAgICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgICAgICBzdXBlcigncHJvamVjdC1pbnB1dCcsICdhcHAnLCB0cnVlLCAndXNlci1pbnB1dCcpXG4gICAgICAgICAgICB0aGlzLnRpdGxlSW5wdXRFbGVtZW50ID0gdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJyN0aXRsZScpIGFzIEhUTUxJbnB1dEVsZW1lbnQ7XG4gICAgICAgICAgICB0aGlzLmRlc2NyaXB0aW9uSW5wdXRFbGVtZW50ID0gdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJyNkZXNjcmlwdGlvbicpIGFzIEhUTUxJbnB1dEVsZW1lbnQ7XG4gICAgICAgICAgICB0aGlzLnBlb3BsZUVsZW1lbnQgPSB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcignI3Blb3BsZScpIGFzIEhUTUxJbnB1dEVsZW1lbnQ7XG4gICAgICAgICAgICB0aGlzLmNvbmZpZ3VyZSgpO1xuICAgIFxuICAgICAgICB9XG4gICAgXG4gICAgICAgIGNvbmZpZ3VyZSgpIHtcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCB0aGlzLnN1Ym1pdEhhbmRsZXIpXG4gICAgICAgIH1cbiAgICBcbiAgICAgICAgcHJpdmF0ZSBnYXRoZXJVc2VySW5wdXQoKTogW3N0cmluZywgc3RyaW5nLCBudW1iZXJdIHwgdW5kZWZpbmVkIHtcbiAgICAgICAgICAgIGNvbnN0IGVudGVyZWRUaXRsZSA9IHRoaXMudGl0bGVJbnB1dEVsZW1lbnQudmFsdWU7XG4gICAgICAgICAgICBjb25zdCBlbnRlcmVkRGVzY3JpcHRpb24gPSB0aGlzLmRlc2NyaXB0aW9uSW5wdXRFbGVtZW50LnZhbHVlO1xuICAgICAgICAgICAgY29uc3QgZW50ZXJlZFBlb3BsZSA9IHRoaXMucGVvcGxlRWxlbWVudC52YWx1ZTtcbiAgICBcbiAgICAgICAgICAgIGNvbnN0IHRpdGxlVmFsaWRhdGU6IFZhbGlkYXRhYmxlID0ge1xuICAgICAgICAgICAgICAgIHZhbHVlOiBlbnRlcmVkVGl0bGUsXG4gICAgICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWVcbiAgICAgICAgICAgIH1cbiAgICBcbiAgICAgICAgICAgIGNvbnN0IGRlc2NyaXB0aW9uVmFsaWRhdGU6IFZhbGlkYXRhYmxlID0ge1xuICAgICAgICAgICAgICAgIHZhbHVlOiBlbnRlcmVkRGVzY3JpcHRpb24sXG4gICAgICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgbWluTGVuZ3RoOiA1XG4gICAgICAgICAgICB9XG4gICAgXG4gICAgICAgICAgICBjb25zdCBwZW9wbGVWYWxpZGF0ZTogVmFsaWRhdGFibGUgPSB7XG4gICAgICAgICAgICAgICAgdmFsdWU6ICtlbnRlcmVkUGVvcGxlLFxuICAgICAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLFxuICAgICAgICAgICAgICAgIG1pbjogMSxcbiAgICAgICAgICAgICAgICBtYXg6IDVcbiAgICAgICAgICAgIH1cbiAgICBcbiAgICAgICAgICAgIGlmICghdmFsaWRhdGUodGl0bGVWYWxpZGF0ZSkgfHwgIXZhbGlkYXRlKGRlc2NyaXB0aW9uVmFsaWRhdGUpIHx8ICF2YWxpZGF0ZShwZW9wbGVWYWxpZGF0ZSkpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyh0aXRsZVZhbGlkYXRlLCBwZW9wbGVWYWxpZGF0ZSwgZGVzY3JpcHRpb25WYWxpZGF0ZSlcbiAgICAgICAgICAgICAgICBhbGVydCgnSW52YWxpZCBJbnB1dCwgcGxlYXNlIHRyeSBhZ2FpbiEnKVxuICAgICAgICAgICAgICAgIHJldHVyblxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gW2VudGVyZWRUaXRsZSwgZW50ZXJlZERlc2NyaXB0aW9uLCArZW50ZXJlZFBlb3BsZV1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIFxuICAgICAgICBwcml2YXRlIGNsZWFySW5wdXRzKCkge1xuICAgICAgICAgICAgdGhpcy50aXRsZUlucHV0RWxlbWVudC52YWx1ZSA9IFwiXCI7XG4gICAgICAgICAgICB0aGlzLmRlc2NyaXB0aW9uSW5wdXRFbGVtZW50LnZhbHVlID0gXCJcIjtcbiAgICAgICAgICAgIHRoaXMucGVvcGxlRWxlbWVudC52YWx1ZSA9IFwiXCI7XG4gICAgXG4gICAgICAgIH1cbiAgICBcbiAgICBcbiAgICAgICAgQGF1dG9iaW5kXG4gICAgICAgIHByaXZhdGUgc3VibWl0SGFuZGxlcihldmVudDogRXZlbnQpIHtcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICBjb25zdCB1c2VySW5wdXQgPSB0aGlzLmdhdGhlclVzZXJJbnB1dCgpO1xuICAgICAgICAgICAgY29uc29sZS5sb2codXNlcklucHV0KVxuICAgIFxuICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodXNlcklucHV0KSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IFt0aXRsZSwgZGVzY3JpcHRpb24sIHBlb3BsZV0gPSB1c2VySW5wdXQ7XG4gICAgICAgICAgICAgICAgcHJvamVjdFN0YXRlLmFkZFByb2plY3QodGl0bGUsIGRlc2NyaXB0aW9uLCBwZW9wbGUpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHRpdGxlLCBkZXNjcmlwdGlvbiwgcGVvcGxlKVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc29sZS5sb2codXNlcklucHV0LCBcIllPXCIpXG4gICAgICAgICAgICB0aGlzLmNsZWFySW5wdXRzKClcbiAgICAgICAgfVxuICAgIFxuICAgICAgICByZW5kZXJDb250ZW50KCkge1xuICAgIFxuICAgICAgICB9XG4gICAgfSIsImltcG9ydCB7IENvbXBvbmVudCB9IGZyb20gXCIuL2Jhc2UtY29tcG9uZW50XCI7XG5pbXBvcnQgeyBQcm9qZWN0IH0gZnJvbSAnLi4vbW9kZWxzL3Byb2plY3QnO1xuaW1wb3J0IHsgRHJhZ2dhYmxlIH0gZnJvbSAnLi4vbW9kZWxzL2RyYWctZHJvcCc7XG5pbXBvcnQgeyBhdXRvYmluZCB9IGZyb20gJy4uL2RlY29yYXRvcnMvYXV0b2JpbmQnO1xuXG5cbiAgICBleHBvcnQgY2xhc3MgUHJvamVjdEl0ZW0gZXh0ZW5kcyBDb21wb25lbnQ8SFRNTFVMaXN0RWxlbWVudCwgSFRNTExJRWxlbWVudD4gaW1wbGVtZW50cyBEcmFnZ2FibGUge1xuICAgICAgICBwcml2YXRlIHByb2plY3Q6IFByb2plY3Q7XG4gICAgXG4gICAgXG4gICAgICAgIGdldCBwZXJzb25zKCkge1xuICAgICAgICAgICAgaWYodGhpcy5wcm9qZWN0LnBlb3BsZSA9PT0gMSkge1xuICAgICAgICAgICAgICAgIHJldHVybiAnMSBQZXJzb24nO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYCR7dGhpcy5wcm9qZWN0LnBlb3BsZX0gcGVyc29uc2BcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIFxuICAgICAgICBjb25zdHJ1Y3Rvcihob3N0SWQ6IHN0cmluZywgcHJvamVjdDogUHJvamVjdCkge1xuICAgICAgICAgICAgc3VwZXIoJ3NpbmdsZS1wcm9qZWN0JywgaG9zdElkLCBmYWxzZSwgcHJvamVjdC5pZCk7XG4gICAgICAgICAgICB0aGlzLnByb2plY3QgPSBwcm9qZWN0O1xuICAgICAgICAgICAgdGhpcy5jb25maWd1cmUoKTtcbiAgICAgICAgICAgIHRoaXMucmVuZGVyQ29udGVudCgpO1xuICAgICAgICB9XG4gICAgXG4gICAgICAgIEBhdXRvYmluZFxuICAgICAgICBkcmFnU3RhcnRIYW5kbGVyKGV2ZW50OiBEcmFnRXZlbnQpIHtcbiAgICAgICAgICAgIGV2ZW50LmRhdGFUcmFuc2ZlciEuc2V0RGF0YSgndGV4dC9wbGFpbicsIHRoaXMucHJvamVjdC5pZCk7XG4gICAgICAgICAgICBldmVudC5kYXRhVHJhbnNmZXIhLmVmZmVjdEFsbG93ZWQgPSAnbW92ZSc7XG4gICAgICAgIH1cbiAgICBcbiAgICBcbiAgICAgICAgZHJhZ0VuZEhhbmRsZXIoXzogRHJhZ0V2ZW50KSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnRHJhZ0VuZCcpO1xuICAgICAgICB9XG4gICAgXG4gICAgICAgIFxuICAgICAgICBjb25maWd1cmUoKSB7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignZHJhZ3N0YXJ0JywgdGhpcy5kcmFnU3RhcnRIYW5kbGVyKVxuICAgICAgICB9XG4gICAgXG4gICAgICAgIHJlbmRlckNvbnRlbnQoKSB7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcignaDInKSEudGV4dENvbnRlbnQgPSB0aGlzLnByb2plY3QudGl0bGU7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcignaDMnKSEudGV4dENvbnRlbnQgPSB0aGlzLnBlcnNvbnMgKyAnIGFzc2lnbmVkISc7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcigncCcpIS50ZXh0Q29udGVudCA9IHRoaXMucHJvamVjdC5kZXNjcmlwdGlvbjtcbiAgICAgICAgfVxuICAgIH1cbiIsImltcG9ydCB7IERyYWdUYXJnZXQgfSBmcm9tICcuLi9tb2RlbHMvZHJhZy1kcm9wJztcbmltcG9ydCB7IENvbXBvbmVudCB9IGZyb20gJy4uL2NvbXBvbmVudHMvYmFzZS1jb21wb25lbnQnO1xuaW1wb3J0IHsgcHJvamVjdFN0YXRlIH0gZnJvbSAnLi4vc3RhdGUvcHJvamVjdC1zdGF0ZSc7XG5pbXBvcnQgeyBhdXRvYmluZCB9IGZyb20gJy4uL2RlY29yYXRvcnMvYXV0b2JpbmQnO1xuaW1wb3J0IHtQcm9qZWN0LCBQcm9qZWN0U3RhdHVzIH0gZnJvbSAnLi4vbW9kZWxzL3Byb2plY3QnXG5pbXBvcnQge1Byb2plY3RJdGVtfSBmcm9tICcuL3Byb2plY3QtaXRlbSdcblxuXG4gICAgZXhwb3J0IGNsYXNzIFByb2plY3RMaXN0IGV4dGVuZHMgQ29tcG9uZW50PEhUTUxEaXZFbGVtZW50LCBIVE1MRWxlbWVudD4gaW1wbGVtZW50cyBEcmFnVGFyZ2V0e1xuICAgICAgICBhc3NpZ25lZFByb2plY3RzOiBQcm9qZWN0W107XG4gICAgXG4gICAgICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgdHlwZTogJ2FjdGl2ZScgfCAnZmluaXNoZWQnKSB7XG4gICAgICAgICAgICBzdXBlcigncHJvamVjdC1saXN0JywgJ2FwcCcsIGZhbHNlLCBgJHt0eXBlfS1wcm9qZWN0c2ApXG4gICAgICAgICAgICB0aGlzLmFzc2lnbmVkUHJvamVjdHMgPSBbXTtcbiAgICBcbiAgICAgICAgICAgIHRoaXMuY29uZmlndXJlKCk7XG4gICAgICAgICAgICB0aGlzLnJlbmRlckNvbnRlbnQoKTtcbiAgICAgICAgfVxuICAgIFxuICAgICAgICBAYXV0b2JpbmRcbiAgICAgICAgZHJvcEhhbmRsZXIoZXZlbnQ6IERyYWdFdmVudCkge1xuICAgICAgICAgICAgY29uc3QgcHJqSWQgPSBldmVudC5kYXRhVHJhbnNmZXIhLmdldERhdGEoJ3RleHQvcGxhaW4nKTtcbiAgICAgICAgICAgIHByb2plY3RTdGF0ZS5tb3ZlUHJvamVjdChwcmpJZCwgdGhpcy50eXBlID09PSAnYWN0aXZlJyA/IFByb2plY3RTdGF0dXMuQWN0aXZlIDogUHJvamVjdFN0YXR1cy5GaW5pc2hlZClcbiAgICAgICAgfVxuICAgIFxuICAgICAgICBAYXV0b2JpbmRcbiAgICAgICAgZHJhZ092ZXJIYW5kbGVyKGV2ZW50OiBEcmFnRXZlbnQpIHtcbiAgICAgICAgICAgIGlmKGV2ZW50LmRhdGFUcmFuc2ZlciAmJiBldmVudC5kYXRhVHJhbnNmZXIudHlwZXNbMF0gPT09ICd0ZXh0L3BsYWluJykge1xuICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgY29uc3QgbGlzdEVsID0gdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ3VsJykhO1xuICAgICAgICAgICAgICAgIGxpc3RFbC5jbGFzc0xpc3QuYWRkKCdkcm9wcGFibGUnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICB9XG4gICAgXG4gICAgICAgIEBhdXRvYmluZFxuICAgICAgICBkcmFnTGVhdmVIYW5kbGVyKF86IERyYWdFdmVudCkge1xuICAgIFxuICAgICAgICAgICAgY29uc3QgbGlzdEVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigndWwnKSE7XG4gICAgICAgICAgICBsaXN0RWwuY2xhc3NMaXN0LnJlbW92ZSgnZHJvcHBhYmxlJyk7XG4gICAgICAgIH1cbiAgICBcbiAgICAgICAgcHJpdmF0ZSByZW5kZXJQcm9qZWN0cygpIHtcbiAgICAgICAgICAgIGNvbnN0IGxpc3RFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGAke3RoaXMudHlwZX0tcHJvamVjdHMtbGlzdGApISBhcyBIVE1MVUxpc3RFbGVtZW50O1xuICAgICAgICAgICAgbGlzdEVsLmlubmVySFRNTCA9ICcnO1xuICAgICAgICAgICAgZm9yIChjb25zdCBwcmpJdGVtIG9mIHRoaXMuYXNzaWduZWRQcm9qZWN0cykge1xuICAgICAgICAgICAgICAgIG5ldyBQcm9qZWN0SXRlbSh0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcigndWwnKSEuaWQsIHByakl0ZW0pXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICBcbiAgICAgICAgY29uZmlndXJlKCkge1xuICAgICAgICAgICAgdGhpcy5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdvdmVyJywgdGhpcy5kcmFnT3ZlckhhbmRsZXIpO1xuICAgICAgICAgICAgdGhpcy5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdsZWF2ZScsIHRoaXMuZHJhZ0xlYXZlSGFuZGxlcik7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignZHJvcCcsIHRoaXMuZHJvcEhhbmRsZXIpO1xuICAgIFxuICAgICAgICAgICAgcHJvamVjdFN0YXRlLmFkZExpc3RlbmVyKChwcm9qZWN0czogUHJvamVjdFtdKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVsZXZhbnRQcm9qZWN0cyA9IHByb2plY3RzLmZpbHRlcihwcmogPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy50eXBlID09PSAnYWN0aXZlJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHByai5zdGF0dXMgPT09IFByb2plY3RTdGF0dXMuQWN0aXZlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBwcmouc3RhdHVzID09PSBQcm9qZWN0U3RhdHVzLkZpbmlzaGVkO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgdGhpcy5hc3NpZ25lZFByb2plY3RzID0gcmVsZXZhbnRQcm9qZWN0cztcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlclByb2plY3RzKCk7XG4gICAgICAgICAgICB9KVxuICAgICAgICB9XG4gICAgXG4gICAgICAgIHJlbmRlckNvbnRlbnQoKSB7XG4gICAgICAgICAgICBjb25zdCBsaXN0SWQgPSBgJHt0aGlzLnR5cGV9LXByb2plY3RzLWxpc3RgXG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcigndWwnKSEuaWQgPSBsaXN0SWQ7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcignaDInKSEudGV4dENvbnRlbnQgPSB0aGlzLnR5cGUudG9VcHBlckNhc2UoKSArICcgUFJPSkVDVFMnXG4gICAgICAgIH1cbiAgICB9XG4iLCJpbXBvcnQge1Byb2plY3RJbnB1dH0gZnJvbSAnLi9jb21wb25lbnRzL3Byb2plY3QtaW5wdXQnXG5pbXBvcnQge1Byb2plY3RMaXN0fSBmcm9tICcuL2NvbXBvbmVudHMvcHJvamVjdC1saXN0J1xuXG5cbm5ldyBQcm9qZWN0SW5wdXQoKTtcbm5ldyBQcm9qZWN0TGlzdCgnYWN0aXZlJyk7XG5uZXcgUHJvamVjdExpc3QoJ2ZpbmlzaGVkJyk7XG5cblxuXG4iXSwibmFtZXMiOlsiQ29tcG9uZW50IiwiY29uc3RydWN0b3IiLCJ0ZW1wbGF0ZUlkIiwiaG9zdEVsZW1lbnRzIiwiaW5zZXJ0QXRTdGFydCIsIm5ld0VsZW1lbnRJZCIsInRoaXMiLCJ0ZW1wbGF0ZUVsZW1lbnQiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiaG9zdEVsZW1lbnQiLCJpbXBvcnRlZE5vZGUiLCJpbXBvcnROb2RlIiwiY29udGVudCIsImVsZW1lbnQiLCJmaXJzdEVsZW1lbnRDaGlsZCIsImlkIiwiYXR0YWNoIiwiaW5zZXJ0QXRCZWdpbm5pbmciLCJpbnNlcnRBZGphY2VudEVsZW1lbnQiLCJ2YWxpZGF0ZSIsInZhbGlkYXRhYmxlSW5wdXQiLCJpc1ZhbGlkIiwicmVxdWlyZWQiLCJ2YWx1ZSIsInRvU3RyaW5nIiwidHJpbSIsImxlbmd0aCIsIm1pbkxlbmd0aCIsIm1heExlbmd0aCIsIm1pbiIsIm1heCIsImF1dG9iaW5kIiwiXyIsIl8yIiwiZGVzY3JpcHRvciIsIm9yaWdpbmFsTWV0aG9kIiwiY29uZmlndXJhYmxlIiwiZ2V0IiwiYmluZCIsIlByb2plY3RTdGF0dXMiLCJQcm9qZWN0IiwidGl0bGUiLCJkZXNjcmlwdGlvbiIsInBlb3BsZSIsInN0YXR1cyIsIlN0YXRlIiwibGlzdGVuZXJzIiwiYWRkTGlzdGVuZXIiLCJsaXN0ZW5lckZuIiwicHVzaCIsIlByb2plY3RTdGF0ZSIsInN1cGVyIiwicHJvamVjdHMiLCJnZXRJbnN0YW5jZSIsImluc3RhbmNlIiwiYWRkUHJvamVjdCIsIm51bU9mUGVvcGxlIiwibmV3UHJvamVjdCIsIk1hdGgiLCJyYW5kb20iLCJBY3RpdmUiLCJ1cGRhdGVMaXN0ZW5lcnMiLCJtb3ZlUHJvamVjdCIsInByb2plY3RJZCIsIm5ld1N0YXR1cyIsInByb2plY3QiLCJmaW5kIiwicHJqIiwic2xpY2UiLCJwcm9qZWN0U3RhdGUiLCJQcm9qZWN0SW5wdXQiLCJ0aXRsZUlucHV0RWxlbWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJkZXNjcmlwdGlvbklucHV0RWxlbWVudCIsInBlb3BsZUVsZW1lbnQiLCJjb25maWd1cmUiLCJhZGRFdmVudExpc3RlbmVyIiwic3VibWl0SGFuZGxlciIsImdhdGhlclVzZXJJbnB1dCIsImVudGVyZWRUaXRsZSIsImVudGVyZWREZXNjcmlwdGlvbiIsImVudGVyZWRQZW9wbGUiLCJ0aXRsZVZhbGlkYXRlIiwiZGVzY3JpcHRpb25WYWxpZGF0ZSIsInBlb3BsZVZhbGlkYXRlIiwiY29uc29sZSIsImxvZyIsImFsZXJ0IiwiY2xlYXJJbnB1dHMiLCJldmVudCIsInByZXZlbnREZWZhdWx0IiwidXNlcklucHV0IiwiQXJyYXkiLCJpc0FycmF5IiwicmVuZGVyQ29udGVudCIsIlByb2plY3RJdGVtIiwicGVyc29ucyIsImhvc3RJZCIsImRyYWdTdGFydEhhbmRsZXIiLCJkYXRhVHJhbnNmZXIiLCJzZXREYXRhIiwiZWZmZWN0QWxsb3dlZCIsImRyYWdFbmRIYW5kbGVyIiwidGV4dENvbnRlbnQiLCJQcm9qZWN0TGlzdCIsInR5cGUiLCJhc3NpZ25lZFByb2plY3RzIiwiZHJvcEhhbmRsZXIiLCJwcmpJZCIsImdldERhdGEiLCJGaW5pc2hlZCIsImRyYWdPdmVySGFuZGxlciIsInR5cGVzIiwiY2xhc3NMaXN0IiwiYWRkIiwiZHJhZ0xlYXZlSGFuZGxlciIsInJlbW92ZSIsInJlbmRlclByb2plY3RzIiwiaW5uZXJIVE1MIiwicHJqSXRlbSIsInJlbGV2YW50UHJvamVjdHMiLCJmaWx0ZXIiLCJsaXN0SWQiLCJ0b1VwcGVyQ2FzZSJdLCJzb3VyY2VSb290IjoiIn0=